- name: Setup zsh
  vars:
    the_user: "{{ ansible_user_id }}"
  tags:
    - cli
    - zsh
  block:
    - name: Enable Copr for starship
      become: true
      community.general.copr:
        name: atim/starship
      when: ansible_facts['distribution'] == "Fedora"
    - name: Install zsh and config dependencies
      become: true
      ansible.builtin.package:
        name: "{{ pkgs.zsh }}"
        state: present
    - name: Install syntax highlighting
      ansible.builtin.git:
        repo: https://github.com/zsh-users/zsh-syntax-highlighting
        dest: "{{ lookup('env', 'HOME') }}/.config/zsh/plugins/zsh-syntax-highlighting"
    - name: Install autosuggestions
      ansible.builtin.git:
        repo: https://github.com/zsh-users/zsh-autosuggestions
        dest: "{{ lookup('env', 'HOME') }}/.config/zsh/plugins/zsh-autosuggestions"
    - name: Change shell to zsh
      become: yes
      user:
        name: "{{ the_user }}"
        shell: /bin/zsh
