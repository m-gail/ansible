- name: Setup zsh
  vars:
    the_user: "{{ ansible_user_id }}"
  tags:
    - cli
    - zsh
  block:
    - name: Enable Copr for starship
      become: true
      community.general.copr:
        name: atim/starship
      when: ansible_facts['distribution'] == "Fedora"
    - name: Download starship for debian
      become: true
      ansible.builtin.get_url:
        checksum: sha256:d7269514fa450678790f37d41c691e4a80492b127b861e30e252a6646040b615
        url: https://github.com/starship/starship/releases/download/v1.15.0/starship-x86_64-unknown-linux-gnu.tar.gz
        dest: /tmp/starship.tar.gz
    - name: Install starship for Debian
      become: true
      ansible.builtin.unarchive:
        remote_src: true
        src: /tmp/starship.tar.gz
        dest: "{{ lookup('env', 'HOME') }}/.local/bin"
      when: ansible_facts['distribution'] == "Debian"
    - name: Install zsh and config dependencies
      become: true
      ansible.builtin.package:
        name: "{{ pkgs.zsh }}"
        state: present
    - name: Install syntax highlighting
      ansible.builtin.git:
        repo: https://github.com/zsh-users/zsh-syntax-highlighting
        dest: "{{ lookup('env', 'HOME') }}/.config/zsh/plugins/zsh-syntax-highlighting"
    - name: Install autosuggestions
      ansible.builtin.git:
        repo: https://github.com/zsh-users/zsh-autosuggestions
        dest: "{{ lookup('env', 'HOME') }}/.config/zsh/plugins/zsh-autosuggestions"
    - name: Change shell to zsh
      become: yes
      user:
        name: "{{ the_user }}"
        shell: /bin/zsh
    - include: ../lib/dotfiles.yml
      vars:
        directories:
          - zsh
