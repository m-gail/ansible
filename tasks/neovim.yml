- name: Setup neovim
  tags:
    - cli
    - neovim
  block:
    - name: Enable Copr for neovim nightly
      become: true
      community.general.copr:
        name: agriffis/neovim-nightly
      when: ansible_facts['distribution'] == "Fedora"
    - name: Install neovim nightly and plugin dependencies
      become: true
      ansible.builtin.package:
        name: "{{ pkgs.neovim }}"
        state: present
    - name: Create .local/bin on debian
      file:
        path: "{{ lookup('env', 'HOME') }}/.local/bin"
        state: directory
        recurse: true
    - name: Install latest AppImage on Debian
      ansible.builtin.get_url:
        url: https://github.com/neovim/neovim/releases/download/v0.9.1/nvim.appimage
        checksum: sha256:262892176e21da0902c4f0b1e027d54d21b4bcae6b0397afccd8a81b476c3055
        dest: "{{ lookup('env', 'HOME') }}/.local/bin/nvim"
        mode: "u+x"
      when: ansible_facts['distribution'] == "Debian"
    - name: Create SourcePackages directory
      ansible.builtin.file:
        path: "{{ lookup('env', 'HOME') }}/SourcePackages"
        state: directory
    - name: Clone vscode-java-test
      ansible.builtin.git:
        repo: https://github.com/microsoft/vscode-java-test
        dest: "{{ lookup('env', 'HOME') }}/SourcePackages/vscode-java-test"
    - name: Install jdk version
      shell:
        cmd: source $HOME/.sdkman/bin/sdkman-init.sh && yes n | sdk install java 17.0.7-tem
      args:
        executable: /bin/bash
    - name: Install vscode-java-test
      shell:
        cmd: source $HOME/.sdkman/bin/sdkman-init.sh && sdk use java 17.0.7-tem && cd $HOME/SourcePackages/vscode-java-test && npm install && npm run build-plugin
      args:
        executable: /bin/bash
    - name: Clone java-debug
      ansible.builtin.git:
        repo: https://github.com/microsoft/java-debug
        dest: "{{ lookup('env', 'HOME') }}/SourcePackages/java-debug"
    - name: Install java-debug
      shell:
        cmd: source $HOME/.sdkman/bin/sdkman-init.sh && sdk use java 17.0.7-tem && cd $HOME/SourcePackages/java-debug && ./mvnw clean install
      args:
        executable: /bin/bash
